# 分销平台前端 AGENT 指南

> 目标：为负责编写分销平台前端的智能体提供最小必要上下文。需求、技术方案与任务拆解请同步维护于同目录下的文档。

## 项目背景

- 分销平台是独立入口，面向销售人员与分销商，消费者站点保持分离。
- 后端由 .NET 团队负责鉴权、订单、客户、佣金等领域逻辑，并统一访问 AWS 托管数据库。
- 前端沿用消费者站技术栈（Next.js 15 + TypeScript + Tailwind v4 + Zustand + shadcn/ui），与既有站点共享组件、hooks、样式与国际化资源。
- 代码建议放置在 monorepo 的 `apps/distributor` 下，通过 `packages/ui`、`packages/api-client`、`packages/models` 复用能力。

## 角色矩阵与导航

| 角色       | 关键入口             | 核心模块                                                           |
| ---------- | -------------------- | ------------------------------------------------------------------ |
| 销售人员   | 登录后进入销售中心   | 主页仪表盘、订单列表/详情、退款申请、顾客管理、任务中心、个人中心  |
| 分销商     | 登录后进入分销商中心 | 主页提成看板、订单列表（含二级分销订单）、二级分销商管理、个人中心 |
| 二级分销商 | 由分销商管理         | 账号申请、启停控制（前端需提供审批占位）                           |

- 登录后需按身份分流，未授权访问需降级至 403/404。
- 导航、面包屑与权限守卫必须复用共享布局，避免在页面壳层重复实现业务逻辑。

## 工程基线

1. **项目初始化**（对照 `todo.md` Phase 1）：
   - 生成 `apps/distributor` App Router 工程，配置全局 Tailwind、shadcn/ui 主题与路径别名。
   - 在 `packages/*` 中沉淀可复用的 UI 组件、API 客户端、模型与校验，确保消费者站与分销平台共享。
   - 建立 Zustand store 骨架与国际化结构；Mock 数据可通过 Server Actions 或 REST 拦截提供。
2. **鉴权与布局**（Phase 2）：
   - 对接后端登录/注册/重置接口，落地 Token 存储与刷新策略。
   - 实现角色守卫、错误兜底页，并搭建统一的顶部、侧导航、通知与面包屑。
3. **业务迭代**：
   - Phase 3 聚焦销售端（仪表盘、订单、退款、顾客、任务）。
   - Phase 4 覆盖分销商端（提成看板、一级/二级订单、二级分销商管理、个人中心复用）。
   - Phase 5 强化公共能力（API 切换、文件上传、富文本、图表封装、权限指令、埋点）。
   - Phase 6 进行联调、测试与交付。

## 数据访问与状态

- 所有数据通过 .NET API；新增字段时必须同步更新 `packages/models` 与 Mock 数据。
- 鉴权状态交由后端 Token/Cookie 方案管理，前端负责消费接口与处理异常状态。
- 根据页面复杂度，在 Server Actions、`@tanstack/react-query` 或 SWR 之间择优；客户端共享状态坚持使用 Zustand，并通过 selector 减少重渲染。
- Mock/真实接口切换需在公共 API 封装层实现，避免页面感知差异。

## UI、可视化与交互

- 首选已有 shadcn/ui 组件；表格继续使用 `@tanstack/react-table`，图表建议统一封装（例如 `recharts`）。
- Tailwind 类名顺序按照“布局 → 间距 → 视觉”，仅在复杂交互前添加必要注释。
- Dashboards 建议抽象 `DashboardCard`、`TrendChart` 等组件，确保销售与分销两端复用。

## 质量要求

- 所有提交必须跑通：`npm run lint`、`npm run prettier:check`、`npm run build`。
- 关键路径需补充单测或 Playwright 冒烟用例（登录 → 仪表盘 → 订单 → 退款）。
- 引入新环境变量或外部依赖时，更新 `.env.example` 或 CI 配置并写明消耗方式。

## 推荐工作流

1. 阅读 `docs/fenxiao/` 下的需求、技术方案与 `todo.md`，确认阶段目标与联调窗口。
2. 在 `packages/*` 中优先补齐共享能力，再在 `apps/distributor` 中实现页面壳层与路由。
3. 每次迭代结束更新 `docs/fenxiao/todo.md` 勾选状态，保持上下游同步。
4. 对接后端或设计变更时，记录接口与字段调整，并及时更新 Mock 与类型定义。
5. 交付前自查鉴权流程、角色切换、权限守卫、上传与仪表盘渲染是否符合需求。

## 风险提示

- 鉴权、权限与数据隔离由 .NET 提供，前端需严谨处理未授权状态与角色权限。
- 文件上传需预留 OSS/S3 签名策略，当前阶段使用占位方案但保持接口抽象。
- 国际化需兼顾中文、日文、英文；尽量复用既有翻译资源，避免硬编码。
- Dashboard 数据量大时需关注性能，必要时增加分页、抽屉或懒加载策略。

---

如需更多上下文，可查阅：

- `docs/fenxiao/分销平台技术方案.md`
- `docs/fenxiao/分销平台需求整理.md`
- `docs/fenxiao/todo.md`
